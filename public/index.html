<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§§ æ–°å¹´ç¦®ç‰©è¿½è¹¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #fdf2f2; font-family: 'Segoe UI', sans-serif; }
        .timeline { border-left: 3px solid #dc3545; padding-left: 20px; margin-top: 20px; }
        .timeline-item { margin-bottom: 20px; position: relative; }
        .timeline-item::before { content: 'ğŸ'; position: absolute; left: -34px; top: 0px; background: #fff; border-radius: 50%; }
        .signature-box { border: 2px dashed #dc3545; padding: 10px; background: white; transform: rotate(-2deg); margin-top: 15px;}
        .signature-img { width: 100%; max-width: 200px; }
    </style>
</head>
<body class="container py-5">
    <div class="card shadow border-0">
        <div class="card-header bg-danger text-white text-center py-3">
            <h2 class="mb-0">ğŸ§§ æ–°å¹´å¿«éæŸ¥è©¢</h2>
        </div>
        <div class="card-body p-4">
            <div class="input-group mb-3">
                <input type="text" id="trackId" class="form-control form-control-lg" placeholder="è¼¸å…¥å–®è™Ÿ (ä¾‹: NY-001)">
                <button class="btn btn-dark" onclick="track()">ğŸ” æŸ¥è©¢</button>
            </div>

            <div id="result" class="d-none">
                <div class="alert alert-warning d-flex justify-content-between align-items-center">
                    <div>
                        <strong>ç‹€æ…‹ï¼š</strong> <span id="statusText" class="fs-5 fw-bold"></span>
                    </div>
                    <span id="location" class="badge bg-danger"></span>
                </div>
                <p class="fs-5">æ”¶ä»¶äººï¼š<span id="recipient" class="fw-bold"></span></p>

                <div id="sigSection" class="d-none text-center">
                    <div class="signature-box">
                        <p class="text-muted mb-1"><small>å·²ç”±æœ¬äººè¦ªè‡ªç°½æ”¶</small></p>
                        <img id="sigImg" class="signature-img">
                    </div>
                </div>

                <h5 class="mt-4 border-bottom pb-2">ğŸ“¦ é‹é€æ­·ç¨‹</h5>
                <div class="timeline" id="history"></div>
            </div>
        </div>
    </div>

    <script>
        // å…è¨±ç¶²å€å¸¶å…¥åƒæ•¸è‡ªå‹•æŸ¥è©¢
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('id')) {
            document.getElementById('trackId').value = urlParams.get('id');
            track();
        }

        async function track() {
            const id = document.getElementById('trackId').value.trim();
            if(!id) return alert("è«‹è¼¸å…¥å–®è™Ÿ");
            
            try {
                const res = await fetch(`/api/track?id=${id}`);
                if (!res.ok) throw new Error();
                const data = await res.json();

                document.getElementById('result').classList.remove('d-none');
                document.getElementById('statusText').innerText = data.status;
                document.getElementById('recipient').innerText = data.recipient;
                document.getElementById('location').innerText = data.location;

                // æ­·ç¨‹æ¸²æŸ“
                let html = '';
                data.history.reverse().forEach(h => {
                    html += `<div class="timeline-item">
                        <div class="fw-bold text-danger">${h.status}</div>
                        <div class="text-muted small">${h.time}</div>
                        <div>${h.location}</div>
                    </div>`;
                });
                document.getElementById('history').innerHTML = html;

                // ç°½åé¡¯ç¤º
                if (data.signature) {
                    document.getElementById('sigSection').classList.remove('d-none');
                    document.getElementById('sigImg').src = data.signature;
                } else {
                    document.getElementById('sigSection').classList.add('d-none');
                }
            } catch (e) {
                alert('æŸ¥ç„¡æ­¤å–®è™Ÿï¼Œæ˜¯ä¸æ˜¯é‚„åœ¨æº–å‚™ä¸­ï¼Ÿ');
            }
        }
    </script>
</body>
</html>
